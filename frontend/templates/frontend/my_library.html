<!DOCTYPE html>
<html>
<head>
    <title>My Game Library</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            font-family: Arial, Helvetica, sans-serif;
        }

        .container {
            max-width: 1200px;
        }

        h2 {
            font-weight: 600;
            margin-top: 40px;
            margin-bottom: 30px;
        }

        .row {
            justify-content: center;
        }

        .col-md-4 {
            display: flex;
            justify-content: center;
        }

        /* Kafel gry — bez wymuszonej wysokości */
        .game-card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.2s ease;
            width: 100%;
            max-width: 320px;
        }

        .game-card:hover {
            transform: translateY(-5px);
        }

        /* Obrazek w kaflu gry — zapewnia równą wysokość dla wszystkich okładek */
        .img-container {
            width: 100%;
            height: 260px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .game-title {
            text-align: center;
            font-weight: 600;
            font-size: 1.15rem;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .game-title a {
            text-decoration: none;
            color: #000;
            transition: color 0.2s ease;
        }

        .game-title a:hover {
            color: #007bff;
        }

        /* Styl dla przycisku dodawania gry */
        /* Styl przycisku dodawania gry — dokładnie taki sam rozmiar jak kafelki z grami */
        .add-wrapper {
            flex: 0 0 auto;
        }

        .add-card {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 320px;      /* stała szerokość */
            height: 320px;     /* dopasowana wysokość do kafelków */
            border-radius: 10px;
            border: 3px dashed #bbb;
            color: #666;
            font-size: 9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 0 auto;    /* wyśrodkowanie w kolumnie */
        }

        .add-card:hover {
            background-color: #f8f9fa;
            color: #007bff;
            border-color: #007bff;
            transform: translateY(-3px);
        }

        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            line-height: 24px;
            transition: background-color 0.2s ease;
        }

        .delete-btn:hover {
            background-color: rgba(200, 0, 0, 1);
        }

    </style>
</head>
<body>
<div class="container text-center">
    <h2>My Game Library</h2>

    <div class="row gy-5">
        <!-- Kafelek dodawania nowej gry -->
        <div class="col-md-4 add-wrapper">
            <a href="/app/search/" class="text-decoration-none">
                <div class="add-card">+</div>
            </a>
        </div>


        <!-- Gry z historii użytkownika -->
        {% if page_obj %}
            {% for game in page_obj %}
                <div class="col-md-4">
                    <div class="game-card position-relative">
                        <!-- Przycisk X -->
                        <button class="delete-btn" data-game-id="{{ game.id }}">&times;</button>

                        <div class="img-container">
                            {% if game.cover_image %}
                                <img src="/media/{{ game.cover_image }}" alt="{{ game.title }}">
                            {% else %}
                                <img src="/media/placeholder.jpg" alt="No image">
                            {% endif %}
                    </div>
                <div class="game-title">
            <a href="/app/games/{{ game.id }}/">{{ game.title }}</a>
        </div>
    </div>
</div>

            {% endfor %}
        {% else %}
            <p>No games in your library yet.</p>
        {% endif %}
    </div>
</div>
<script>
document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", function() {
        const gameId = this.getAttribute("data-game-id");
        if (!confirm("Czy na pewno chcesz usunąć tę grę z historii?")) return;

        fetch("/app/delete_history/", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCookie("csrftoken")
            },
            body: JSON.stringify({ game_id: gameId })
        })
        .then(res => res.json())
        .then(data => {
            if (data.message) {
                // Usunięcie kafelka z DOM
                this.closest(".col-md-4").remove();
            } else {
                alert(data.error || "Wystąpił błąd podczas usuwania.");
            }
        })
        .catch(err => {
            console.error("Error:", err);
            alert("Wystąpił błąd połączenia z serwerem.");
        });
    });
});

// [PL] Funkcja pobierająca CSRF token z ciasteczek (potrzebna do POST)
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let cookie of cookies) {
            cookie = cookie.trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
</body>
</html>
